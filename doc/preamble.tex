\IfFileExists{t1futs.fd}{\usepackage{fourier}}{}
\IfFileExists{putb8a.pfb}{\usepackage{helvet}}{\usepackage{lmodern}}
\usepackage[T1]{fontenc}
\usepackage[latin9]{inputenc}
\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}
\usepackage{babel}
\usepackage{verbatim}
\usepackage{graphicx}
\usepackage{url}
\usepackage{amsmath}
\usepackage{amssymb}

% MC STYLE
\usepackage[a4paper]{geometry}
\geometry{verbose,tmargin=3cm,bmargin=3cm,lmargin=3.5cm,rmargin=3.0cm}
\usepackage[pagestyles]{titlesec}
\usepackage[unicode,colorlinks,breaklinks]{hyperref}
\usepackage{float}
\usepackage{caption}
\usepackage[sort&compress,numbers]{natbib}
\usepackage{microtype}
\usepackage{etoolbox}
\setlength{\emergencystretch}{2em}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% page layout
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\widowpenalty=200
\clubpenalty=200
\setlength{\parskip}{0.0ex plus 0.5ex minus 0.0ex}
% headings
\renewpagestyle{headings}[\small]{
\headrule \sethead{ %
{\ifnumgreater{\value{chapter}}{0}{Chapter \thechapter}{\bf \chaptertitle}} %
}{ %
{   \ifnumgreater{\value{chapter}}{0}{\bf \chaptertitle}{}} %
} %
{ \usepage}
}
\pagestyle{headings}

%empty page to pad chapters
\makeatletter
\def\cleardoublepage{\clearpage\if@twoside \ifodd\c@page\else
\hbox{}
\vspace*{\fill}
\begin{center}
\ 
\end{center}
\vspace{\fill}
\thispagestyle{empty}
\newpage
\if@twocolumn\hbox{}\newpage\fi\fi\fi}
\makeatother
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% spacings (use a lot of rubber lenghts)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\setlength{\floatsep}{2ex plus 5ex minus 1ex }
\setlength{\textfloatsep}{3ex plus 3ex minus 1ex }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% floats setup
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% positioning
\renewcommand{\topfraction}{0.85}
\renewcommand{\bottomfraction}{0.85}
\renewcommand{\textfraction}{0.15}
\renewcommand{\floatpagefraction}{0.65}
\setcounter{topnumber}{2}
\setcounter{bottomnumber}{2}
%default placement
\floatplacement{figure}{btp}
% caption
\captionsetup{margin=10pt,font=small,labelfont=bf}

%%%%%%%%%%%%%%%%%%%%%%%%%%%
% chapter headings
%%%%%%%%%%%%%%%%%%%%%%%%%%%
\titleformat{\chapter}[display]{\normalfont\huge\bfseries}%
{\vspace{1.5em}\raggedleft\large\chaptertitlename ~\thechapter\hrule\vspace{-0.5ex}}
{-0.25ex}{\begin{minipage}{0.75\textwidth}\raggedright}[\end{minipage}]
\makeatletter


%%%%%%%%%%%%%%%%%%%%%%%%%%%
% properties and fields formatting
%%%%%%%%%%%%%%%%%%%%%%%%%%%
% old version using ifthenelse
%\newcommand{\ipiitem}[3]{%   
%  \ifthenelse{ \equal{#1}{} } %
%             {} %
%             { \ifthenelse{ \equal{#1}{\underline{\smash{}}} } %
%                          {} %
%                          {  %
%      {\noindent\textbf{#1}:\rule{0.0pt}{1.05\baselineskip}\quad} % uses a strut to add a bit of vertical space
%                          } %
%             } %
%   {#2}\parskip=0pt\par
%   \ifthenelse{ \equal{#3}{} } %
%              {} %
%              { {\hfill\raggedleft\textit{\small #3}\par} }
%}

\newcommand{\ipiitem}[3]{%
   \ifblank{#1} % if no name is specified just output nothing
           {} %  
           { \ifstrequal{#1}{\underline{\smash{}}} % also in this case
             {} %
             { % print out beautifully
               {\noindent\textbf{#1}:\rule{0.0pt}{1.05\baselineskip}\quad} % uses a strut to add a bit of vertical space
             } %
           } %
    {#2}\parskip=0pt\par % prints the help text
   \ifblank{#3}{} %
          { {\hfill\raggedleft\textit{\small #3}\par} } % details string
}

\makeatletter
\newenvironment{ipifield}[4]{ %
   \ifblank{#1} {} {\vspace{0.5em}}  % some spacing between fields
   \noindent\parskip=0pt\begin{tabular}[t]{|p{1.0\linewidth}}   % table filling the whole line -- fields cannot break
      %cell without border
      \multicolumn{1}{@{}p{1.0\linewidth}}{
         \ipiitem{\underline{\smash{#1}}}{#2}{}  % name and help string
         \ifblank{#4} % if there are no attributes, write here the details
                 {  \ifblank{#3} {} % if there are any....
                            {{\hfill\raggedleft\textit{\small #3}}\par}}
                 {} %else do nothing here
         } \vspace{-1em}\\ % close multicol, go down and back up
      % cell with border (only if attributes are present)
      \ifblank{#4} {} % do nothing if there are no attributes (the details may just have been printed above
              { \ifblank{#3} {} { \vspace{-1em}{\hfill\raggedleft\textit{\small #3}}\par } % print the details
                {#4} \vspace{-1em} \\\hline } % negative vspace to undo the line break
   \end{tabular}
   \parskip=0pt\list{}{\listparindent 1.5em % indent the body of the environment 
         \leftmargin    \listparindent
         \rightmargin   0pt
         \parsep        0pt
         \itemsep       0pt
         \topsep        0pt
          }%
    \item\relax
 }
 {\endlist}
\makeatother

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% User specified LaTeX commands.
\usepackage{color}
\usepackage{multicol}\makeindex
\usepackage{xspace}
\usepackage[numbers]{natbib}

\newenvironment{code}{%
\footnotesize 
\verbatim
}{
\endverbatim
\normalsize
}

\makeatother

\newcommand{\dd}{\; \mathrm{d}} 
\newcommand{\Tr}{\mathrm{Tr}} 
\newcommand{\bra}{< \! \!} 
\newcommand{\ket}{\! \! >} 
\newcommand{\betan}{\beta_N} 
\newcommand{\logn}{\mathrm{ln}} 
\newcommand{\expon}{\mathrm{exp}} 
\newcommand{\Imag}{\mathrm{Im}}
\newcommand{\ipi}{{i-PI}\xspace}
\newcommand{\DFT}{Quantum Espresso, CP2K, CPMD and FHI-AIMS }
\newcommand{\empirical}{LAMMPS}
